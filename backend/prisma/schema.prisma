generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id            String         @id @default(uuid())
  uid           String?        @unique
  email         String         @unique
  password      String
  name          String?
  businessName  String?
  officeAddress String?
  postCode      String?
  createdAt     DateTime       @default(now())
  refreshTokens RefreshToken[]
  properties    Property[]
  booking       Booking[]
}

model Property {
  id             String   @id @default(uuid())
  uid            String   @unique
  name           String
  imageUrl       String?
  address        String?
  city           String?
  country        String?
  postCode       String?
  reference      String?
  propertyValue  Float?
  propertyType   String?
  accessProperty String?
  dimensions     String?
  bedrooms       Int?
  bathrooms      Int?
  floors         Int?
  features       String?
  ownerId        String
  propertyOn     String?
  owner          User     @relation(fields: [ownerId], references: [id])
  createdAt      DateTime @default(now())
}

enum BookingStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

model Service {
  id          String    @id @default(uuid())
  uid         String    @unique
  name        String
  description String?
  createdAt   DateTime  @default(now())
  bookings    Booking[]
}

model Booking {
  id        String        @id @default(uuid())
  uid       String        @unique
  userId    String? // owner (nullable si booking anonym)
  user      User?         @relation(fields: [userId], references: [id])
  serviceId String
  service   Service       @relation(fields: [serviceId], references: [id])
  total     Int? // total units / price (adaptable)
  details   String? // texte libre
  status    BookingStatus @default(PENDING)
  date      DateTime? // date du booking / event date
  createdAt DateTime      @default(now())
}

model RefreshToken {
  id           String         @id @default(uuid())
  tokenHash    String
  userId       String
  user         User           @relation(fields: [userId], references: [id])
  revoked      Boolean        @default(false)
  createdAt    DateTime       @default(now())
  expiresAt    DateTime
  replacedById String? // doit être du même type que id
  replacedBy   RefreshToken?  @relation("replacement", fields: [replacedById], references: [id])
  replaced     RefreshToken[] @relation("replacement")
}
